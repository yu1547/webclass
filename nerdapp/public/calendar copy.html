<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Todolist</title>
    <style>
        /* 這裡可以添加你的 CSS 樣式 */
    </style>
</head>

<body>
    <div id="todolist-container">
        <!-- 這裡將動態生成的 todolist 放置 -->
    </div>
    <script>
        // 這裡是你的 JavaScript 程式碼
        const exams = [
            {
                name: "期末考",
                date: new Date("2023-12-31"),
                importance: 6,
                subject: [
                    { name: "數學", clock: 4, finish: 0 },
                    { name: "物理", clock: 3, finish: 0 }
                ],
                finish: 0,
                total: 0
            },
            {
                name: "微積分",
                date: new Date("2023-1-31"),
                importance: 2,
                subject: [
                    { name: "微積分", clock:13, finish: 0 },
                ],
                finish: 0,
                total: 0
            }
        ];

        const freeTimes = [
            { day: "星期三", start: "19:00", end: "21:00" },
            { day: "星期五", start: "15:00", end: "18:00" }
        ];

        const todolist = [];

        // 設定番茄鐘和休息時間
        const tomatoDuration = 25; // 一個番茄鐘的時間（分鐘）
        const shortBreakDuration = 5; // 短休息時間（分鐘）

        // 計算每個科目的權重
        const calculateWeight = (exam, subject, currentTime) => {
            const daysUntilExam = Math.ceil((exam.date - currentTime) / (1000 * 60 * 60 * 24));
            return exam.importance * subject.clock / (daysUntilExam * 3);
        };

        // 遍歷每個考試
        exams.forEach((exam) => {
            // 遍歷每個科目
            exam.subject.forEach((subject) => {
                let remainingTomatoes = subject.clock;

                // 遍歷每個空閒時間
                freeTimes.forEach((freeTime) => {
                    const currentTime = new Date(`2023-12-25 ${freeTime.start}`);
                    const endTime = new Date(`2023-12-25 ${freeTime.end}`);

                    // 安排番茄鐘和休息時間
                    let tomatoCount = 0;
                    while (remainingTomatoes > 0) {
                        const weight = calculateWeight(exam, subject, currentTime);
                        if (weight < 0) continue; // 如果權重為負，則跳過此科目

                        // 檢查是否有足夠的時間來完成一個番茄鐘和一個休息時間
                        const nextTime = new Date(currentTime.getTime());
                        nextTime.setMinutes(nextTime.getMinutes() + tomatoDuration);
                        if (nextTime > endTime) break;

                        const timeSlot = {
                            subjectName: subject.name,
                            examName: exam.name,
                            startTime: currentTime.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),
                            endTime: '',
                            completed: false,
                        };

                        // 更新時間，減去一個番茄鐘的時間
                        currentTime.setMinutes(currentTime.getMinutes() + tomatoDuration);
                        timeSlot.endTime = currentTime.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                        todolist.push(timeSlot);
                        remainingTomatoes--;
                        tomatoCount++;

                        // 檢查是否有足夠的時間來完成休息時間
                        const breakEndTime = new Date(currentTime);
                        // 如果已經完成四個番茄鐘，則休息時間為20分鐘，否則為5分鐘
                        breakEndTime.setMinutes(breakEndTime.getMinutes() + (tomatoCount % 4 === 0 ? 20 : shortBreakDuration));
                        if (breakEndTime > endTime) break;

                        // 安排休息時間
                        if (remainingTomatoes > 0) {
                            todolist.push({
                                subjectName: "休息",
                                examName: "",
                                startTime: currentTime.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),
                                endTime: breakEndTime.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),
                                completed: false,
                            });

                            currentTime.setMinutes(breakEndTime.getMinutes());
                        }
                    }

                });
            });
        });

        // 取得todolist-container元素
        const todolistContainer = document.getElementById('todolist-container');

        // 將todolist顯示在網頁上
todolist.forEach((item) => {
    const itemDiv = document.createElement('div');
    itemDiv.innerHTML = `
<p>${item.subjectName} (${item.examName}) ${item.date} ${item.startTime} 到 ${item.endTime} 是否完成: <input type="checkbox" ${item.completed ? 'checked' : ''}></p>
`;
    todolistContainer.appendChild(itemDiv);
});
    </script>
</body>

</html>